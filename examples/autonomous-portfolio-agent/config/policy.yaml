version: '2.0'

# MASTER SWITCH: Set to false to disable ALL AgentArc checks
enabled: true

# PolicyLayer configuration for autonomous portfolio manager
# KEY FEATURE: No manual blacklist - honeypots detected automatically via simulation!

policies:
  # Limit maximum ETH value per transaction
  - type: eth_value_limit
    max_value_wei: '100000000000000000'  # 0.1 ETH max per transaction
    enabled: true
    description: "Prevents excessive ETH spending in single transaction"

  # Per-token spending limits
  - type: per_asset_limit
    enabled: true
    description: "Enforce maximum amounts per token"
    asset_limits:
      - name: USDC
        address: '0x036CbD53842c5426634e7929541eC2318f3dCF7e'
        max_amount: '50000000'  # 50 USDC (6 decimals)
        decimals: 6

      - name: WETH
        address: '0x4200000000000000000000000000000000000006'
        max_amount: '200000000000000000'  # 0.2 WETH (18 decimals)
        decimals: 18

  # Trusted contract allowlist (prevents false positives from LLM)
  - type: address_allowlist
    enabled: true
    description: "Whitelist known safe contracts to avoid false positives"
    allowed_addresses:
      - '0x94cC0AaC535CCDB3C01d6787D6413C739ae12bc4'  # Uniswap V3 SwapRouter02
      - '0xC5290058841028F1614F3A6F0F5816cAd0df5E27'  # Uniswap V3 QuoterV2
      - '0x4752ba5DBc23f44D87826276BF6Fd6b1C372aD24'  # Uniswap V3 Factory
      - '0x4200000000000000000000000000000000000006'  # WETH (Base Sepolia)
      - '0x036CbD53842c5426634e7929541eC2318f3dCF7e'  # USDC (Base Sepolia)

  # NOTE: We intentionally DO NOT use address_denylist!
  # Reason: We want to demonstrate automatic honeypot detection
  # The system will detect unknown honeypots via Stage 3.5 simulation

#Simulation
simulation:
  enabled: true
  provider: 'tenderly'
  fail_on_revert: true
  description: "Simulates transactions before execution"

# LLM-based Security Analysis
llm_validation:
  enabled: true
  provider: 'openai'
  model: 'gpt-4o-mini'
  description: "AI-powered pattern detection for advanced threats"

  # Confidence thresholds
  warn_threshold: 0.40   # 40% confidence → warning (log but allow)
  block_threshold: 0.70  # 70% confidence → block transaction

  # Security patterns to detect
  patterns:
    - unlimited_approvals      # Approve(spender, type(uint256).max)
    - unusual_fund_flows       # Unexpected token movements
    - hidden_fees              # Fee-on-transfer tokens
    - honeypot_indicators      # Transfer restrictions, fake balances
    - fake_token_balances      # balanceOf() manipulation
    - transfer_restrictions    # Only owner can transfer
    - reentrancy               # Reentrancy attack patterns
    - delegatecall_risks       # Delegatecall to untrusted contracts
    - time_lock_manipulation   # Time locks that never unlock

# Calldata validation
calldata_validation:
  enabled: true
  description: "Parse and validate transaction calldata"

# Gas limits
gas_limit: 500000

# Logging configuration
logging:
  level: info  # Valid values: minimal, info, debug
  log_blocked_transactions: true
  log_allowed_transactions: true
  log_file: 'policy_engine.log'
  include_simulation_details: true
  include_llm_reasoning: true

# Network configuration
network:
  chain_id: 84532  # Base Sepolia
  rpc_timeout: 30
  max_retries: 3